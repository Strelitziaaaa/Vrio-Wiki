## 概述
---
早期计算机的各部件之间是通过单独的连线互连的，这种方式称为分散连接。

随着I/O设备的种类和数量越来越多，为更好解决I/O设备和主机之间连接的灵活性，计算机结构从分散连接发展为总线连接。

总线定义：总线是一组能为多个部件分时和共享的公共信息传递线路。

分时和共享是总线的两个特点。

* 分时是指同一时刻只允许有一个部件向总线发送信息，若系统中有多个部件，则它们只能分时地向总线发送信息。
* 共享是指总线上可以挂接多个部件，各部件之间互相交换的信息都可以通过这组线路分时共享，多个部件可同时从总线上接收相同的信息。 

总线设备：总线上所连接的设备，按其对总线有无控制功能可分为主设备和从设备两种。

* 主设备：发出总线请求且获得总线控制权的设备。
* 从设备：被主设备访问的设备，它只能响应从主设备发来的各种总线命令。

总线特性：指机械特性（尺寸、形状、）、电气特性（传输方向和有效的电平范围）、功能特性（每根传输线的功能）和时间特性（信号和时序的关系）。

总线分类：

1. 按功能层次分类
   1. 片内总线
   芯片内部的总线，用于CPU芯片内部各寄存器之间及寄存器与ALU的连接。
   2. 系统总线
   计算机系统内各功能部件（CPU、主存、I/O接口）之间相互连接的总线。按系统总线传输信息内容的不同，可分3类：数据总线、地址总线和控制总线。

   数据总线用在各部件之间传输数据、指令和中断型号等，它是双向传输总线，数据总线的位数反映一次能传送的数据的位数。

   地址总线用来指出数据总线上源数据或目的数据所在的主存单元或I/O端口的地址，它是单向传输总线，地址总线的位数反映最大的寻址空间。

   控制总线用来传输各种命令、反馈和定时信号，典型的控制信号包括时钟、复位、总线请求/允许、中断请求/回答、存储器读/写、I/O读、I/O写、传输确认等。
   3. I/O总线
   主要用于连接中低速的I/O设备，通过I/O接口与系统总线相连接，目的是将低速设备与高速总线分离，以提升总线的系统性能，常见的有USB、PCI总线。
   4. 通信总线
   计算机系统之间或计算机系统与其他系统（如远程通信设备、测试设备）之间传送信息的总线，通信总线也称外部总线。
2. 按时序方式分类
   1. 同步总线
   总线上连接的部件或设备通过统一的时钟进行同步，在规定的时钟节拍内进行规定的总线操作，来完成部件或设备之间的信息传输。
   2. 异步总线 
   总线上连接的部件或设备没有统一的时钟，而以信号握手的方式来协调各部件或设备之间的信息传输，总线操作时序不是固定的。
3. 按数据传输方式分类
   1. 串行总线
   只有一条双向传输或两条单向传输的数据线，数据按比特位串行顺序传输，其效率低于并行总线。串行传输对数据线的要求不太高，因此适合长距离通信。
   2. 并行总线
   有多条双向传输的数据线，可以实现多比特位的同时传输，其效率比串行总线更高。缺点是各条数据线之间相互干扰还会造成传输错误，因此并行总线适合近距离通信。

系统总线的结构：

1. 单总线结构
   单总线结构将CPU、主存、I/O设备（通过I/O接口）都挂在一组总线上，允许I/O设备之间、I/O设备与主存之间直接交换信息。CPU与主存、CPU与外设之间都可以通过总线直接进行信息交换，而无需经过中间设备的干预。串总线并不是指只有一根信号线，系统总线按传送信息的不同可细分为地址总线、数据总线和控制总线。
   ![单总线结构](\composition principle\images\单总线结构.png)

   优点：结构简单，成本低，易于接入新的设备。

   缺点：带宽低、负载重，多个部件只能争用唯一的总线，且不支持并发传送操作。
2. 双总线结构
   双总线结构有两条总线，一条是主存总线，用于在CPU、主存和通道之间传送数据；另一条是I/O总线，用于在多个外部设备与通道之间传送数据。
   ![双总线结构](\composition principle\images\双总线结构.png)

   优点：将低速I/O设备从原单总线上分离出来，实现了存储器总线和I/O总线的分离。

   缺点：需要增加通道等硬件设备。
3. 三总线结构
   三总线结构是在计算机系统各部件之间采用3条各自独立的总线来构成信息通路，这三条总线分别为：主存总线、I/O总线和直接内存访问（DMA）总线。
   ![三总线结构](\composition principle\images\三总线结构.png)

   主存总线用于在CPU和内存之间传送地址、数据和控制信息。I/O总线用于在CPU和各类外设之间通信。DMA总线用于在内存和高速外设之间直接传送数据。

   优点：提高了I/O设备的性能。

   缺点：任意时刻只能使用一种总线，系统工作效率较低。

常见的总线标准：

总线标准是国际上公布的互连各个模块的标准，是各种不同模块组成计算机系统时必须遵守的规范.

典型的总线标准有ISA、EISA、VESA、PCI、AGP、PCI-Express、USB等。它们的主要区别是总线的宽度、带宽、时钟频率、寻址能力、是否支持突发传送等。

* ISA工业标准体系结构，最早出现的系统总线，缺点是传输速率低、CPU占用率高、占用硬件中断资源。属于系统总线，并行总线。
* EISA扩展的ISA，支持多个总线主控器和突发传送，EISA对ISA完全兼容。属于系统总线、并行总线。
* VESA视频电子标准协会。属于局部总线、并行总线。
* PCI外部设备互连。属于局部总线、并行总线。
* AGP加速图形接口。属于局部总线，并行总线。
* PCI-E,PCI-Express。高速串行双通道传输，传输速率远高于PCI、AGP，支持双向传输模式，全双工模式。属于局部总线，串行总线。
* RS-232C。应用于串行二进制交换的数据终端设备（DTE）和数据通信设备（DCE）之间的标准接口。属于设备总线、串行总线。
* USB通用串行总线。一种连接外部设备的I/O总线，具有即插即用、热插拔等优点，具有很强的连接能力。属于设备总线、串行总线。
* PCMCIA。应用于笔记本电脑的接口标准，通常用于扩展功能，具有即插即用功能，属于设备总线，串行总线。
* IDE集成设备电路。更准确称为ATA，硬盘和光驱通过IDE接口于主板连接。属于设备总线，并行总线。
* SCSI小型计算机系统接口。属于设备总线，并行总线。
* SATA串行高级技术附件。属于设备总线，串行总线。

总线的性能指标:

1. 总线时钟周期
   即机器的时钟周期，计算机有一个统一的时钟，以控制整个计算机的各个部件，总线也要受此时钟的控制。  
2. 总线时钟频率
   即机器的时钟频率，它为时钟周期的倒数。
3. 总线传输周期
   指一次总线操作所需的时间，包括申请阶段、寻址阶段、传输阶段和结束阶段。总线传输周期通常由若干总线时钟周期构成。
4. 总线工作频率
   总线上各种操作的频率，为总线周期的倒数。实际上指1秒内传送几次数据。数据周期=N个时钟周期，则总线的工作频率=时钟频率/N。此外若一个时钟周期可以传送K次数据，则总线工作频率是总线时钟频率的K倍。
5. 总线宽度
   也称总线位宽，是总线上能够同时传输的数据位数，通常指数总线的根数，如32根称为32位总线。
6. 总线带宽
   单位时间内总线上最多可传输数据的位数，通常用每秒传送信息的字节数来衡量，单位字节/秒（B/s）。
7. 总线复用
   总线带宽=总线工作频率x（总线宽度/8） 
8. 信号线数
   地址总线、数据总线和控制总线3种总线数的总和称为信号线数。

   总线最主要的性能指标位总线宽度、总线工作频率、总线带宽。总线带宽是总线的最大数据传输速率，它是衡量总线性能的重要指标。

总线带宽=总线宽度x总线工作频率。

## 总线事务和定时
---

总线事务：从请求总线到完成总线使用的操作序列称为总线事务，它是在一个总线周期中发生的一系列活动。

典型的总线事务包括：请求操作、仲裁操作、地址传输、数据传输、总线释放。

1. 请求阶段
   主设备（CPU或DMA）发出总线传输请求，并且获得总线控制权。
2. 仲裁阶段
   总线仲裁机构决定将下一个传输周期的总线使用权授予某个申请者。
3. 寻址阶段
   主设备通过总线给出要访问的从设备地址及有关命令，启动从模块
4. 传输阶段
   主模块和从模块进行数据交换，可单向或双向进行数据传送。
5. 释放阶段
   主模块的有关信息均从系统总线上撤除，让出总线使用权。

总线上的数据传送方式分为非突发方式和突发方式两种。非突发传送方式在每个传送周期内都先传送地址，再传送数据，主从设备之间通常每次只能传输一个字长的数据。

突发（猝发）方式能够进行连续成组数据传送，其寻址阶段发送的是连续数据单元的首地址，在传输阶段送多个连续单元的数据，每个时钟周期可以传送一个字长的信息，但是不释放总线，直到一组数据全部传送完毕后，再释放总线。

总线定时：总线在双方交换数据的过程中需要时间上配合关系的控制，这种控制称为总线定时，其实质是一种协议或规则，主要有同步、异步、半同步和分离式四种定时方式。

1. 同步定时方式
2. 异步定时方式
3. 半同步定时方式
4. 分离式定时方式